(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{276:function(e,t,n){e.exports=n.p+"static/media/bg.2810fe6b.png"},284:function(e,t,n){e.exports=n(630)},306:function(e,t){},308:function(e,t){},324:function(e,t){},326:function(e,t){},553:function(e,t){},626:function(e,t,n){},629:function(e,t,n){},630:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(109),s=n.n(o),i=n(633),c=n(281),u=n(53),l=n(273),d=(n(52),n(274),n(11)),m=new d.AppConfig(["store_write","publish_data"]),p=new d.UserSession({appConfig:m}),f={appConfig:m,userSession:p},h=Object(u.c)({mainReducers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;switch((arguments.length>1?arguments[1]:void 0).type){case"LOGINING_IN":return{appConfig:m,userSession:p};default:return e}}}),b=n(275),v=n.n(b),g=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.d,O=Object(u.e)(h,g(Object(u.a)(l.a,v.a))),S=n(29),E=n(30),y=n(32),j=n(31),w=n(33),x=n(634),k=n(635),N=n(632),I=(n(626),function(e){function t(){return Object(S.a)(this,t),Object(y.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(w.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.username,t=this.props.user;return r.a.createElement("nav",{className:"navbar navbar-expand-md navbar-dark bg-blue fixed-top"},r.a.createElement(N.a,{className:"navbar-brand",to:"/"},"Blockris"),r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(N.a,{className:"nav-link",to:"/profile"},e))),r.a.createElement("img",{src:t.avatarUrl()?t.avatarUrl():"./avatar-placeholder.png",class:"avatar",width:"25",height:"25",alt:""}),r.a.createElement("button",{className:"btn btn-primary",onClick:this.props.signOut.bind(this)},"Sign out"))}}]),t}(a.Component)),D=new d.AppConfig(["store_write","publish_data"]),L=function(e){function t(e){var n;return Object(S.a)(this,t),(n=Object(y.a)(this,Object(j.a)(t).call(this,e))).state={tasks:[],value:""},n}return Object(w.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.userSession.loadUserData().username,t=this.props.userSession.loadUserData(),n=new d.Person(t);return r.a.createElement("div",{className:"Dashboard"},r.a.createElement(I,{username:e,user:n,signOut:this.props.handleSignOut}),r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement("h3",{className:"user-info"},e,"'s Portal")),r.a.createElement("br",null),r.a.createElement("div",{className:"column justify-content-center"},r.a.createElement(N.a,{to:"/profile"},r.a.createElement("h1",null,"Profile")),r.a.createElement(N.a,{to:"/blockris"},r.a.createElement("h1",null,"Play Now")),r.a.createElement(N.a,{to:"/leaderboard"},r.a.createElement("h1",null,"Leaderboard")),r.a.createElement("h1",null,"Tournaments (Coming Soon)"),r.a.createElement("h1",null,"Battle (Coming Soon)")))}}]),t}(a.Component);L.defaultProps={userSession:new d.UserSession(D)};var C=L,P=function(e){function t(){return Object(S.a)(this,t),Object(y.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(w.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.handleSignIn;return r.a.createElement("div",{className:"panel-landing",id:"section-1"},r.a.createElement("h1",{className:"landing-heading"},"Welcome to Blockris!"),r.a.createElement("p",{className:"lead"},r.a.createElement("button",{className:"btn btn-primary btn-lg",id:"signin-button",onClick:e.bind(this)},"Sign In with Blockstack")))}}]),t}(a.Component),U=n(16),J=function(){return Array.from(Array(20),function(){return Array(12).fill([0,"clear"])})},_=function(e,t,n){for(var a=n.x,r=n.y,o=0;o<e.tetromino.length;o+=1)for(var s=0;s<e.tetromino[o].length;s+=1)if(0!==e.tetromino[o][s]&&(!t[o+e.pos.y+r]||!t[o+e.pos.y+r][s+e.pos.x+a]||"clear"!==t[o+e.pos.y+r][s+e.pos.x+a][1]))return!0;return!1},A=n(35),T=n(36),M=n(276),Z=n.n(M);function z(){var e=Object(A.a)(["\n  display: flex;\n  align-items: center;\n  padding: 40px;\n  margin: 260px 266px;\n  max-width: 900px;\n  aside {\n    width: 100%;\n    max-width: 200px;\n    display: block;\n    padding: 0 20px;\n  }\n"]);return z=function(){return e},e}function F(){var e=Object(A.a)(["\n  width: 100vw;\n  height: 100vh;\n  background: url(",") #000;\n  background-size: cover;\n  overflow: hidden;\n"]);return F=function(){return e},e}var B=T.a.div(F(),Z.a),G=T.a.div(z());var R=n(279),W={0:{shape:[[0]],color:"0, 0, 0"},I:{shape:[[0,"I",0,0],[0,"I",0,0],[0,"I",0,0],[0,"I",0,0]],color:"80, 227, 230"},J:{shape:[[0,"J",0],[0,"J",0],["J","J",0]],color:"36, 95, 223"},L:{shape:[[0,"L",0],[0,"L",0],[0,"L","L"]],color:"223, 173, 36"},O:{shape:[["O","O"],["O","O"]],color:"223, 217, 36"},S:{shape:[[0,"S","S"],["S","S",0],[0,0,0]],color:"48, 211, 56"},T:{shape:[[0,0,0],["T","T","T"],[0,"T",0]],color:"132, 61, 198"},Z:{shape:[["Z","Z",0],[0,"Z","Z"],[0,0,0]],color:"227, 78, 78"}},H=function(){var e="IJLOSTZ"[Math.floor(Math.random()*"IJLOSTZ".length)];return W[e]};function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var V=function(){var e=Object(a.useState)({pos:{x:0,y:0},tetromino:W[0].shape,collided:!1}),t=Object(U.a)(e,2),n=t[0],r=t[1];function o(e,t){var n=e.map(function(t,n){return e.map(function(e){return e[n]})});return t>0?n.map(function(e){return e.reverse()}):n.reverse()}var s=Object(a.useCallback)(function(){r({pos:{x:4,y:0},tetromino:H().shape,collided:!1})},[]);return[n,function(e){var t=e.x,n=e.y,a=e.collided;r(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(n,!0).forEach(function(t){Object(R.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{pos:{x:e.pos.x+=t,y:e.pos.y+=n},collided:a})})},s,function(e,t){var a=JSON.parse(JSON.stringify(n));a.tetromino=o(a.tetromino,t);for(var s=a.pos.x,i=1;_(a,e,{x:0,y:0});)if(a.pos.x+=i,(i=-(i+(i>0?1:-1)))>a.tetromino[0].length)return o(a.tetromino,-t),void(a.pos.x=s);r(a)}]},X=function(e,t){var n=Object(a.useState)(J()),r=Object(U.a)(n,2),o=r[0],s=r[1],i=Object(a.useState)(0),c=Object(U.a)(i,2),u=c[0],l=c[1];return Object(a.useEffect)(function(){l(0);var n=function(n){var a=n.map(function(e){return e.map(function(e){return"clear"===e[1]?[0,"clear"]:e})});return e.tetromino.forEach(function(t,n){t.forEach(function(t,r){0!==t&&(a[n+e.pos.y][r+e.pos.x]=[t,"".concat(e.collided?"merged":"clear")])})}),e.collided?(t(),function(e){return e.reduce(function(t,n){return-1===n.findIndex(function(e){return 0===e[0]})?(l(function(e){return e+1}),t.unshift(new Array(e[0].length).fill([0,"clear"])),t):(t.push(n),t)},[])}(a)):a};s(function(e){return n(e)})},[e.collided,e.pos.x,e.pos.y,e.tetromino,t]),[o,s,u]};function q(){var e=Object(A.a)(["\n  display: grid;\n  grid-template-rows: repeat(\n    ",",\n    calc(25vw / ",")\n  );\n  grid-template-columns: repeat(",", 1fr);\n  grid-gap: 1px;\n  border: 2px solid #333;\n  width: 100%;\n  max-width: 25vw;\n  background: #111;\n"]);return q=function(){return e},e}var Q=T.a.div(q(),function(e){return e.height},function(e){return e.width},function(e){return e.width});function Y(){var e=Object(A.a)(["\n  width: auto;\n  /* border-radius: 5px; */\n  background: rgba(",", 0.8);\n  border: ",";\n  border-bottom-color: rgba(",", 0.1);\n  border-right-color: rgba(",", 1);\n  border-top-color: rgba(",", 1);\n  border-left-color: rgba(",", 0.3);\n"]);return Y=function(){return e},e}var $=T.a.div(Y(),function(e){return e.color},function(e){return 0===e.type?"0px solid":"4px solid"},function(e){return e.color},function(e){return e.color},function(e){return e.color},function(e){return e.color}),ee=r.a.memo(function(e){var t=e.type;return r.a.createElement($,{type:t,color:W[t].color},console.log("rerender cell"))}),te=function(e){var t=e.stage;return r.a.createElement(Q,{width:t[0].length,height:t.length},t.map(function(e){return e.map(function(e,t){return r.a.createElement(ee,{key:t,type:e[0]})})}))};function ne(){var e=Object(A.a)(["\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  margin: 40px 0 20px 0;\n  padding: 20px;\n  border: 4px solid #333;\n  min-height: 30px;\n  width: 100%;\n  border-radius: 20px;\n  color: ",";\n  background: #000;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 0.8rem;\n"]);return ne=function(){return e},e}var ae=T.a.div(ne(),function(e){return e.gameOver?"red":"#999"}),re=function(e){var t=e.gameOver,n=e.text;return r.a.createElement(ae,{gameOver:t},n)};function oe(){var e=Object(A.a)(["\n  box-sizing: border-box;\n  margin: 0 0 20px 0;\n  padding: 20px;\n  min-height: 30px;\n  width: 100%;\n  border-radius: 20px;\n  border: none;\n  color: white;\n  background: #333;\n  font-family: Pixel, Arial, Helvetica, sans-serif;\n  font-size: 1rem;\n  outline: none;\n  cursor: pointer;\n"]);return oe=function(){return e},e}var se=T.a.button(oe()),ie=function(e){var t=e.callback;return r.a.createElement(se,{onClick:t},"Start Game")},ce=function(e){var t=Object(a.useState)(null),n=Object(U.a)(t,2),o=n[0],s=n[1],i=Object(a.useState)(!1),c=Object(U.a)(i,2),u=c[0],l=c[1],m=V(),p=Object(U.a)(m,4),f=p[0],h=p[1],b=p[2],v=p[3],g=X(f,b),O=Object(U.a)(g,3),S=O[0],E=O[1],y=function(e){var t=Object(a.useState)(0),n=Object(U.a)(t,2),r=n[0],o=n[1],s=Object(a.useState)(0),i=Object(U.a)(s,2),c=i[0],u=i[1],l=Object(a.useState)(0),d=Object(U.a)(l,2),m=d[0],p=d[1],f=[40,100,300,1200],h=Object(a.useCallback)(function(){e>0&&(o(function(t){return t+f[e-1]*(m+1)}),u(function(t){return t+e}))},[m,f,e]);return Object(a.useEffect)(function(){h()},[h,e,r]),[r,o,c,u,m,p]}(O[2]),j=Object(U.a)(y,6),w=j[0],x=j[1],k=j[2],N=j[3],D=j[4],L=j[5];console.log("re-render");var C=function(e){_(f,S,{x:e,y:0})||h({x:e,y:0})},P=function(){k>10*(D+1)&&(L(function(e){return e+1}),s(1e3/(D+1)+200)),_(f,S,{x:0,y:1})?(f.pos.y<1&&(e.userSession.putFile("scores.json",JSON.stringify(w),{encrypt:!1}),console.log("GAME OVER!!!"),l(!0),s(null)),h({x:0,y:0,collided:!0})):h({x:0,y:1,collided:!1})};!function(e,t){var n=Object(a.useRef)();Object(a.useEffect)(function(){n.current=e},[e]),Object(a.useEffect)(function(){if(null!==t){var e=setInterval(function(){n.current()},t);return function(){clearInterval(e)}}},[t])}(function(){P()},o);var A=function(e){var t=e.keyCode;u||(37===t?C(-1):39===t?C(1):40===t?(s(null),P()):38===t&&v(S,1))},T=e.userSession.loadUserData().username,M=e.userSession.loadUserData(),Z=new d.Person(M);return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,{username:T,user:Z,signOut:e.handleSignOut}),r.a.createElement(B,{role:"button",tabIndex:"0",onKeyDown:function(e){return A(e)},onKeyUp:function(e){var t=e.keyCode;u||40===t&&s(1e3/(D+1))}},r.a.createElement(G,null,r.a.createElement(te,{stage:S}),r.a.createElement("aside",null,u?r.a.createElement(re,{gameOver:u,text:"Game Over"}):r.a.createElement("div",null,r.a.createElement(re,{text:"Score: ".concat(w)}),r.a.createElement(re,{text:"rows: ".concat(k)}),r.a.createElement(re,{text:"Level: ".concat(D)})),r.a.createElement(ie,{callback:function(){E(J()),s(1e3),b(),x(0),L(0),N(0),l(!1)}})))))},ue="https://s3.amazonaws.com/onename/avatar-placeholder.png",le=function(e){function t(e){var n;return Object(S.a)(this,t),(n=Object(y.a)(this,Object(j.a)(t).call(this,e))).state={person:{name:function(){return"Anonymous"},avatarUrl:function(){return ue}},username:"",newStatus:"",statuses:[],statusIndex:0,isLoading:!1},n}return Object(w.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"handleNewStatusChange",value:function(e){this.setState({newStatus:e.target.value})}},{key:"handleNewStatusSubmit",value:function(e){this.saveNewStatus(this.state.newStatus),this.setState({newStatus:""})}},{key:"saveNewStatus",value:function(e){var t=this,n=this.props.userSession,a=this.state.statuses,r={id:this.state.statusIndex+1,text:e.trim(),created_at:Date.now()};a.unshift(r);n.putFile("statuses.json",JSON.stringify(a),{encrypt:!0}).then(function(){t.setState({statuses:a})})}},{key:"isLocal",value:function(){return!this.props.match.params.username}},{key:"fetchData",value:function(){var e=this,t=this.props.userSession;if(this.setState({isLoading:!0}),this.isLocal()){t.getFile("statuses.json",{decrypt:!0}).then(function(n){var a=JSON.parse(n||"[]");e.setState({person:new d.Person(t.loadUserData().profile),username:t.loadUserData().username,statusIndex:a.length,statuses:a})}).finally(function(){e.setState({isLoading:!1})})}else{var n=this.props.match.params.username;console.log(n),Object(d.lookupProfile)(n).then(function(t){e.setState({person:new d.Person(t),username:n})}).catch(function(e){console.log("could not resolve profile")});var a={username:n,decrypt:!0};t.getFile("statuses.json",a).then(function(t){var n=JSON.parse(t||"[]");e.setState({statusIndex:n.length,statuses:n})}).catch(function(e){console.log("could not fetch statuses")}).finally(function(){e.setState({isLoading:!1})})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.handleSignOut,a=t.userSession,o=this.state.person,s=this.state.username;return!a.isSignInPending()&&o?r.a.createElement("div",{className:"container"},r.a.createElement(I,{username:s,user:o,signOut:this.props.handleSignOut}),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-offset-3 col-md-6"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("div",{className:"avatar-section"},r.a.createElement("img",{src:o.avatarUrl()?o.avatarUrl():ue,className:"img-rounded avatar",id:"avatar-image"}),r.a.createElement("div",{className:"username"},r.a.createElement("h1",null,r.a.createElement("span",{id:"heading-name"},o.name()?o.name():"Nameless Person")),r.a.createElement("span",null,s),this.isLocal()&&r.a.createElement("span",null,"\xa0|\xa0",r.a.createElement("button",{onClick:n.bind(this)},"Logout"))))),this.isLocal()&&r.a.createElement("div",{className:"new-status"},r.a.createElement("div",{className:"col-md-12"},r.a.createElement("textarea",{className:"input-status",value:this.state.newStatus,onChange:function(t){return e.handleNewStatusChange(t)},placeholder:"What's on your mind?"})),r.a.createElement("div",{className:"col-md-12 text-right"},r.a.createElement("button",{className:"btn btn-primary btn-lg",onClick:function(t){return e.handleNewStatusSubmit(t)}},"Submit"))),r.a.createElement("div",{className:"col-md-12 statuses"},this.state.isLoading&&r.a.createElement("span",null,"Loading..."),this.state.statuses.map(function(e){return r.a.createElement("div",{className:"status",key:e.id},e.text)}))))):null}},{key:"componentWillMount",value:function(){var e=this.props.userSession;this.setState({person:new d.Person(e.loadUserData().profile),username:e.loadUserData().username})}}]),t}(a.Component),de=function(e){function t(e){var n;return Object(S.a)(this,t),(n=Object(y.a)(this,Object(j.a)(t).call(this,e))).state={person:{name:function(){return"Anonymous"}},username:"",scores:[],isLoading:!1},n}return Object(w.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"fetchData",value:function(){var e=this,t=this.props.userSession;this.setState({isLoading:!0});t.getFile("scores.json",{decrypt:!1}).then(function(n){var a=JSON.parse(n||"[]");e.state.scores.push(a),e.setState({person:new d.Person(t.loadUserData().profile),username:t.loadUserData().username,scores:e.state.scores})}).finally(function(){e.setState({isLoading:!1})})}},{key:"render",value:function(){var e=this.props.userSession.loadUserData().username,t=this.props.userSession.loadUserData(),n=new d.Person(t);return r.a.createElement("div",null,r.a.createElement(I,{username:e,user:n,signOut:this.props.handleSignOut}),r.a.createElement("h1",null,"Leaderboards"),r.a.createElement("div",{className:"col-md-12 statuses"},this.state.isLoading&&r.a.createElement("span",null,"Loading..."),this.state.scores.map(function(e){return r.a.createElement("div",{className:"status",key:e.id},e)})))}}]),t}(r.a.Component),me=new d.UserSession({appConfig:D}),pe=function(e){function t(){return Object(S.a)(this,t),Object(y.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(w.a)(t,e),Object(E.a)(t,[{key:"handleSignIn",value:function(e){e.preventDefault(),me.redirectToSignIn()}},{key:"handleSignOut",value:function(e){e.preventDefault(),me.signUserOut(window.location.origin)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"site-wrapper"},r.a.createElement("div",{className:"site-wrapper-inner"},me.isUserSignedIn()?r.a.createElement(x.a,null,r.a.createElement(k.a,{exact:!0,path:"/",render:function(t){return r.a.createElement(C,Object.assign({userSession:me,handleSignOut:e.handleSignOut},t))}}),r.a.createElement(k.a,{exact:!0,path:"/profile",render:function(t){return r.a.createElement(le,Object.assign({userSession:me,handleSignOut:e.handleSignOut},t))}}),r.a.createElement(k.a,{exact:!0,path:"/blockris",render:function(t){return r.a.createElement(ce,Object.assign({userSession:me,handleSignOut:e.handleSignOut},t))}}),r.a.createElement(k.a,{exact:!0,path:"/leaderboard",render:function(t){return r.a.createElement(de,Object.assign({userSession:me,handleSignOut:e.handleSignOut},t))}})):r.a.createElement(P,{userSession:me,handleSignIn:this.handleSignIn})))}},{key:"componentWillMount",value:function(){me.isSignInPending()&&me.handlePendingSignIn().then(function(e){window.location=window.location.origin})}}]),t}(a.Component);n(628),n(629);s.a.render(r.a.createElement(c.a,{store:O},r.a.createElement(i.a,null,r.a.createElement(pe,null))),document.getElementById("root"))}},[[284,1,2]]]);
//# sourceMappingURL=main.dd97e011.chunk.js.map